From 09b18fbe23c7658a5842046e8a02808c49f55651 Mon Sep 17 00:00:00 2001
From: Luca Stefani <luca.stefani.ge1@gmail.com>
Date: Fri, 1 Nov 2019 21:14:29 +0100
Subject: [PATCH 1/4] Add wallpaper privapp whitelist

Change-Id: I044b1d9201ac0b8780fc37a387f401f3dd0ddeac
---
 Android.bp                                  |  9 ++++++++
 privapp_whitelist_com.android.wallpaper.xml | 24 +++++++++++++++++++++
 2 files changed, 33 insertions(+)
 create mode 100644 privapp_whitelist_com.android.wallpaper.xml

diff --git a/Android.bp b/Android.bp
index 58e6413..40e2241 100644
--- a/Android.bp
+++ b/Android.bp
@@ -140,6 +140,15 @@ android_app {
     platform_apis: true,
     manifest: "AndroidManifest.xml",
     additional_manifests: [":WallpaperPicker2_Manifest"],
+    required: ["privapp_whitelist_com.android.wallpaper.xml"],
     overrides: ["WallpaperPicker", "WallpaperPicker2"],
     static_libs: ["ThemePickerApplicationLib"],
 }
+
+prebuilt_etc_xml {
+    name: "privapp_whitelist_com.android.wallpaper.xml",
+    src: "privapp_whitelist_com.android.wallpaper.xml",
+    system_ext_specific: true,
+    filename_from_src: true,
+    sub_dir: "permissions",
+}
diff --git a/privapp_whitelist_com.android.wallpaper.xml b/privapp_whitelist_com.android.wallpaper.xml
new file mode 100644
index 0000000..e3f3b65
--- /dev/null
+++ b/privapp_whitelist_com.android.wallpaper.xml
@@ -0,0 +1,24 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+  ~ Copyright (C) 2019 The Android Open Source Project
+  ~
+  ~ Licensed under the Apache License, Version 2.0 (the "License");
+  ~ you may not use this file except in compliance with the License.
+  ~ You may obtain a copy of the License at
+  ~
+  ~      http://www.apache.org/licenses/LICENSE-2.0
+  ~
+  ~ Unless required by applicable law or agreed to in writing, software
+  ~ distributed under the License is distributed on an "AS IS" BASIS,
+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  ~ See the License for the specific language governing permissions and
+  ~ limitations under the License
+  -->
+<permissions>
+    <privapp-permissions package="com.android.wallpaper">
+        <permission name="android.permission.SET_WALLPAPER_COMPONENT"/>
+        <permission name="android.permission.MODIFY_DAY_NIGHT_MODE"/>
+        <permission name="android.permission.CHANGE_OVERLAY_PACKAGES"/>
+        <permission name="android.permission.WRITE_SECURE_SETTINGS" />
+    </privapp-permissions>
+</permissions>
-- 
2.44.0

